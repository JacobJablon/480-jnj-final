<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xerox</title>
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- Pure three.js code that the A-Frame components use for location-based AR -->
    <script src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js'></script>
    <!-- AR.js A-Frame components (recommended to use version 3.4.5, rather than master) -->
    <script src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js'></script>
    <!-- Animation Components -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>


    <!-- Howler.js for audio playback -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"
        integrity="sha512-xi/RZRIF/S0hJ+yJJYuZ5yk6/8pCiRlEXZzoguSMl+vk2i3m6UjUO/WcZ11blRL/O+rnj94JRGwt/CHbc9+6EA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Bulma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="../styles/poiLocations.css" rel="stylesheet">
    <script src="../src/poiLocations.js"></script>
</head>

<body>
    <a-scene arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false' vr-mode-ui="enabled: false"
        renderer="antialias: true; alpha: true" id="scene">

        <a-assets>
            <a-asset-item id="xeroxLogo" src="../assets/xeroxlogo/result.gltf"></a-asset-item>
            <a-asset-item id="xerox-Tower" src="../assets/xeroxT/result.gltf"></a-asset-item>
            <a-asset-item id="paper" src="../assets/paper/scene.gltf"></a-asset-item>
            <a-asset-item id="xeroxAlto" src="../assets/xerox_alto/scene.gltf"></a-asset-item>
            <a-asset-item id="declineGraph" src="../assets/DeclineG/DeclineG.gltf"></a-asset-item>
            <a-asset-item id="kodak-Tower" src="../assets/kodakT/result.gltf"></a-asset-item>
            <a-asset-item id="bal-Tower" src="../assets/bLHeadQuarters/result.gltf"></a-asset-item>
            <a-asset-item id="bal-Tower" src="../assets/bLHeadQuarters/result.gltf"></a-asset-item>
            <a-asset-item id="bal-Tower" src="../assets/bLHeadQuarters/result.gltf"></a-asset-item>
            <a-asset-item id="bal-Tower" src="../assets/bLHeadQuarters/result.gltf"></a-asset-item>
            <!-- <a-asset-item id="expl" src="../assets/explosion/scene.gltf"></a-asset-item> -->
            <img id="haloidImg" src="../assets/haloid.jpg" />
            <img id="chesterImg" src="../assets/chesterC.jpg" />
            <img id="jnjlogo" src="../assets/jnjLogo.PNG" />

        </a-assets>

        <a-camera gps-new-camera='gpsMinDistance: 5'></a-camera>

        <!-- Overall container entity that holds every other entity -->
        <a-entity id="everything-container" rotation="0 0 0" position="0 0 -20">
            <a-entity id="container1" visible="false">
                <a-entity id="kT" gltf-model="#kodak-Tower" position="0 0 4" scale="1 1 1"
                    material="transparent: true; opacity: 0.5">
                    <a-entity position="0 2 0" text="value:Kodak width:4 align:center ">
                    </a-entity>
                </a-entity>
                <a-entity id="xT" gltf-model="#xerox-Tower" position="0 0 4" scale="0.01 0.01 0.01"
                    material="transparent: true; opacity: 0">
                    <a-entity position="0 2 0" text="value:Xerox width:4 align:center ">
                    </a-entity>

                </a-entity>
                <a-entity id="blT" gltf-model="#bal-Tower" position="0 0 0" scale="0.02 0.02 0.02"
                    material="transparent: true; opacity: 0">
                    <a-entity position="0 2 0" text="value:Bauch&Lomb width:4 align:center ">
                    </a-entity>

                </a-entity>
                <a-image id="logoImg" src="#jnjlogo" height="5" width="5" position="0 0 5"></<a-image>

            </a-entity>

            <a-entity id="container2" visible="false">
                <a-image id="chester-img" src="#chesterImg" visible="false" geometry="" rotation="0 20 0"
                    scale="3.716 3.716 3.716" material="" position="-2.57364 0 5.08327"></a-image>
                <a-image id="haloid-img" src="#haloidImg" visible="false" geometry="" rotation="0 -20 0"
                    scale="3.716 3.716 3.716" position="1.54013 -0.11264 5" material=""></a-image>


            </a-entity>


            <a-entity>
                <a-entity id="xerox-Logo" gltf-model="#xeroxLogo" position="0 0 4" scale="0.01 0.01 0.01"
                    material="transparent: true; opacity: 0">
                </a-entity>

                <a-entity id="xeroxB" gltf-model="#xerox-Tower" position="0 0 4" scale="0.01 0.01 0.01"
                    material="transparent: true; opacity: 0">
                </a-entity>
                <a-entity id="paperObj" gltf-model="#paper" position="0 0 0" scale="0.02 0.02 0.02"
                    material="transparent: true; opacity: 0">
                </a-entity>

                <a-entity id="xerox-Alto" gltf-model="#xeroxAlto" position="0 0 0" scale="1 1 1"
                    material="transparent: true; opacity: 0">
                </a-entity>
                <!-- <a-entity id="explosion" gltf-model="#expl" position="0 0 0" scale="0.02 0.02 0.02"
                material="transparent: true; opacity: 0"
                animation__fadein="property: text.opacity; from: 0; to: 1; dur: 2000; easing: linear; autoplay: false"
                animation__positionout="property: position; from: 0 0 0; to: 0 3 0; dur: 3500; autoplay: true"
                animation__fadeout="property: text.opacity; from: 1; to: 0; dur: 3000; easing: linear; autoplay: false">
            </a-entity> -->
            </a-entity>
            <a-entity id="decline-Graph" gltf-model="#declineGraph" position="" scale="0.02 0.02 0.02"
                material="transparent: true; opacity: 0" rotation="90 0 0">
            </a-entity>

        </a-entity>
    </a-scene>

    <div id="UI">

    </div>

</body>

<script type="module">



    window.onload = () => {
        document.querySelector('a-scene').setAttribute('timeline-control', '');
    }

    const buildTimeline = () => {
        const tl = gsap.timeline({ paused: true });

        const container1 = document.querySelector("#container1");
        const logoImg = document.querySelector("#logoImg");
        const kt = document.querySelector("#kT");
        const xt = document.querySelector("#xT");
        const blt = document.querySelector("#blT");
        const haloidImg = document.querySelector("#haloid-img");
        const chesterImg = document.querySelector("#chester-img");
        const paperObj = document.querySelector("#paperObj");
        const xeroxLogo = document.querySelector("#xerox-Logo");
        const xeroxB = document.querySelector("#xeroxB");
        const declineGraph = document.querySelector("#decline-Graph");
        const container2 = document.querySelector("#container2");



        tl.call(() => {
            container1.setAttribute('visible', true);
        }, null, 0) // 1 second later

            .to(kt.object3D.position, { x: -3, y: 2, duration: 1, ease: "power2.out" }, ">+=1")
            .to(xt.object3D.position, { x: 3, y: 2, duration: 1, ease: "power2.out" }, "<")
            .to(blt.object3D.position, { y: 3, duration: 2, ease: "power2.out" }, "<")
            .call(() => {
                container1.setAttribute('visible', false);
            }, null, ">+=3")
            .to(xeroxLogo.object3D.scale, {
                x: 4, y: 4, z: 4, duration: 2, ease: "power2.out"
            }, "<")

            // section 2
            .call(() => {
                container2.setAttribute('visible', true);
            }, null, ">") // 1 second later
            .call(() => {
                chesterImg.setAttribute('visible', true);
            }, null, ">+=3") // 1 second later
            .call(() => {
                haloidImg.setAttribute('visible', true);
            }, null, ">+=3") // 1 second later
            .call(() => {
                container2.setAttribute('visible', false);
            }, null, "+=3")
            .call(() => {
                xeroxB.setAttribute('visible', true);
            }, null, ">")
            // .call(() => {
            //     //paper swirl function
            // }, null, ">")
            .call(() => {
                declineGraph.setAttribute('visible', true);
            }, null, ">")


        // 1 second later

        return tl;
    }


    AFRAME.registerComponent('timeline-control', {
        init: function () {

            //load sound for scene
            const sound = new Howl({
                src: ['../assets/script_intro.mp3']
            });


            // load captions from JSON file
            let captions = [];
            //change for each scene
            loadCaptions(0).then((captions) => {
                // console.log(captions);

                // Now you'll see the actual parsed captions
                setInterval(() => {
                    if (sound.playing()) {
                        const currentTime = sound.seek();// get current playback time
                        const currentCaption = captions.find(cue =>
                            currentTime >= cue.start && currentTime <= cue.end
                        );

                        captionDisplay.innerHTML = currentCaption ? currentCaption.text : "";
                    }
                }, 100);
            });


            // Load the UI
            let UI = document.querySelector("#UI");
            loadUI(0, UI);

            //Load the time line
            const timeline = buildTimeline();

            // Add onClick events
            let startBtn = document.getElementById("startBtn")
            startBtn.addEventListener("click", () => {
                sound.play();
                timeline.play(); // play from the beginning
                startBtn.style.display = "none";
            });

            const captionDisplay = document.getElementById("captionBox");

            document.getElementById("restartBtn").addEventListener("click", () => {
                sound.stop(); // stop resets the playback and stops it
                sound.play();
                timeline.restart();// play from the beginning
            });

            document.getElementById("mapBtn").addEventListener("click", () => {
                sound.stop(); // stop resets the playback and stops it
                timeline.stop(); // stop the timeline

            });

        }
    });

    // Attach the component to the scene
    document.querySelector('a-scene').setAttribute('timeline-control', '');
</script>

</html>