<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base</title>
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- Pure three.js code that the A-Frame components use for location-based AR -->
    <script src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js'></script>
    <!-- AR.js A-Frame components (recommended to use version 3.4.5, rather than master) -->
    <script src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js'></script>

    <!-- Howler.js for audio playback -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"
        integrity="sha512-xi/RZRIF/S0hJ+yJJYuZ5yk6/8pCiRlEXZzoguSMl+vk2i3m6UjUO/WcZ11blRL/O+rnj94JRGwt/CHbc9+6EA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Bulma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="../styles/poiLocations.css" rel="stylesheet">
    <script src="../src/poiLocations.js"></script>
</head>

<body>
    <a-assets>
        <audio id="script" src="./assetts/script_intro.mp3" preload="auto"></audio>
        <a-asset-item id="xeroxLogo" src="../assets/xerox-logo/xerox.gltf"></a-asset-item>
        <a-asset-item id="xeroxBuilding" src="../assets/xeroxT/result.gltf"></a-asset-item>
        <a-asset-item id="paper" src="../assets/paper/scene.gltf"></a-asset-item>
        <a-asset-item id="xeroxAlto" src="../assets/"></a-asset-item>
        <a-asset-item id="declienGraph" src="../assets/DeclineG/DeclineG.gltf"></a-asset-item>
        <img id="haloidImg" src="../assets/haloid.jpg" />
        <img id="chesterImg" src="../assets/chesterC.jpg" />

    </a-assets>

    <a-camera gps-new-camera='gpsMinDistance: 5'></a-camera>

    <!-- Overall container entity that holds every other entity -->
    <a-entity id="everything-container" rotation="0 0 0" position="0 0 -20">

        <a-entity id="xeroxL" gltf-model="#xeroxLogo" position="0 0 4" scale="1 1 1"
            material="transparent: true; opacity: 0"
            animation__fadein="property: opacity; from: 0; to: 1; dur: 2000; easing: linear; autoplay: false"
            animation__fadeout="property: text.opacity; from: 1; to: 0; dur: 3000; easing: linear; autoplay: false">
        </a-entity>
        <a-entity id="xeroxB" gltf-model="#xeroxBuilding" position="0 0 4" scale="0.01 0.01 0.01"
            material="transparent: true; opacity: 0"
            animation__fadein="property: text.opacity; from: 0; to: 1; dur: 2000; easing: linear; autoplay: false"
            animation__fadeout="property: text.opacity; from: 1; to: 0; dur: 3000; easing: linear; autoplay: false">
        </a-entity>
        <a-entity id="paperO" gltf-model="#paper" position="0 0 0" scale="0.02 0.02 0.02"
            material="transparent: true; opacity: 0"
            animation__fadein="property: text.opacity; from: 0; to: 1; dur: 2000; easing: linear; autoplay: false"
            animation__positionout="property: position; from: 0 0 0; to: 0 3 0; dur: 3500; autoplay: true"
            animation__fadeout="property: text.opacity; from: 1; to: 0; dur: 3000; easing: linear; autoplay: false">
        </a-entity>
        <a-entity id="XeroxA" gltf-model="#paper" position="0 0 0" scale="0.02 0.02 0.02"
            material="transparent: true; opacity: 0"
            animation__fadein="property: text.opacity; from: 0; to: 1; dur: 2000; easing: linear; autoplay: false"
            animation__positionout="property: position; from: 0 0 0; to: 0 3 0; dur: 3500; autoplay: true"
            animation__fadeout="property: text.opacity; from: 1; to: 0; dur: 3000; easing: linear; autoplay: false">
        </a-entity>


        <a-circle src="#rocLogo" radius="2" position="0 0 5" sound="src: #script autoplay: true"></a-circle>
    </a-entity>


    <div id="UI">

    </div>
</body>

<script type="module">

    const init = () => {
        const sound = new Howl({
            src: ['../assets/script_intro.mp3']
        });
        // load captions from JSON file

        let captions = [];
        loadCaptions(0).then((captions) => {
            // console.log(captions);

            // Now you'll see the actual parsed captions
            setInterval(() => {
                if (sound.playing()) {
                    const currentTime = sound.seek();// get current playback time
                    const currentCaption = captions.find(cue =>
                        currentTime >= cue.start && currentTime <= cue.end
                    );


                    captionDisplay.innerHTML = currentCaption ? currentCaption.text : "";
                }
            }, 100);
        });


        // Load the UI
        let UI = document.querySelector("#UI");
        loadUI(0, UI);

        // Add onClick events
        let startBtn = document.getElementById("startBtn")
        startBtn.addEventListener("click", () => {
            sound.play(); // play from the beginning
            startBtn.style.display = "none";
        });

        const captionDisplay = document.getElementById("captionBox");

        document.getElementById("restartBtn").addEventListener("click", () => {
            sound.stop(); // stop resets the playback and stops it
            sound.play(); // play from the beginning
        });

        document.getElementById("mapBtn").addEventListener("click", () => {
            sound.stop(); // stop resets the playback and stops it

        });


    };

    window.onload = init;

</script>

</html>